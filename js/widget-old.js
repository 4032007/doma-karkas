!function(a,b){function c(a){return decodeURIComponent(Array.prototype.map.call(atob(a),function(a){return"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)}).join(""))}function d(){return"number"!=typeof a.orientation?a.innerHeight/a.innerWidth>1?"portrait":"landscape":0===a.orientation||180===a.orientation?"portrait":"landscape"}function e(a,b){b=b||1;var c=r.hasOwnProperty("logging")?r.logging:-1;if(c>=b){var d="CTV: "+a;switch(b){case 0:console.error(d);break;case 1:console.warn(d);break;case 2:console.info(d)}}}function f(){}function g(a,b,c,d,e,f){this.cid=a,this.wid=b,this.uid=d,this.pid=c,this.device=f,this.config=e}function h(){A+=1,a.CTVWidget.init(r)}function i(){var b=document.getElementById("c2v-root");b&&b.remove();var c=document.getElementById("c2v-style");c&&c.remove();var d;d=Object.prototype.hasOwnProperty.call(a,"onorientationchange")?"orientationchange":"resize",a.removeEventListener("message",a.c2vMessageFunc),a.addEventListener?a.removeEventListener(d,a.c2vOrientFunc):a.attachEvent&&a.detachEvent(d,a.c2vOrientFunc),a.CTVWidget.widgetConfiguration=null}function j(){i(),a.CTVWidget.checkConfigs(),A=-1}function k(){if(B!==window.location.pathname){var b=a.CTVWidget.widgetConfiguration;if(B=window.location.pathname,b&&a.CTVTargeting.checkRules(b,null,null,!1))return;j()}}!function(b,c){b.getCheckingValues=function(b){for(var d=c?a.location.href:b.referer,e=c?a.navigator.userAgent:b.ua,f={},g=d.slice(d.indexOf("?")+1).split("&"),h=0;h<g.length;h++){var i=g[h].split("=");f[i[0]]=i[1]}return{url:d,urlVariables:f,jsVariables:c?a:{},ua:e}},b.checkDomain=function(a,b){if("landing"===b.kind)return!0;var c;c=a.url.indexOf("://")>-1?a.url.split("/")[2]:a.url.split("/")[0],c=c.split(":")[0],c=c.split("?")[0],c=c.toLowerCase();var d=p.toUnicode(c),e=0===b.domain.lastIndexOf("www.",0)?b.domain.substr(4):b.domain;return e=e.toLowerCase(),c.slice(-e.length)===e||d.slice(-e.length)===e?!0:(this.log("wrong domain. Value: "+c+" | Config: "+b.domain,q.Warning),!1)},b.checkURL=function(a,b){var c=a.url.split("/").slice(3).join("/");for(var d in b.displays_settings.url){var e=b.displays_settings.url[d];if(Object.prototype.hasOwnProperty.call(e,"right")){var f=!0;switch(e.condition){case 1:(1==e.right&&c!=e.value||0==e.right&&c==e.value)&&(f=!1);break;case 2:(1==e.right&&-1===c.indexOf(e.value)||0==e.right&&-1!==c.indexOf(e.value))&&(f=!1);break;case 3:(1==e.right&&-1!==c.indexOf(e.value)||0==e.right&&-1===c.indexOf(e.value))&&(f=!1)}if(!f)return this.log("Wrong url params: Values: "+JSON.stringify(c)+" | Config "+JSON.stringify(b.displays_settings.url)),!1}}return!0},b.checkJSVariables=function(a,b){if(!c)return!0;for(var d in b.displays_settings.vars){var e=b.displays_settings.vars[d];if(Object.prototype.hasOwnProperty.call(e,"right")){var f=a.jsVariables.hasOwnProperty(e["var"])&&a.jsVariables[e["var"]]==e.value,g=f&&1==e.right||!f&&0==e.right;if(!g)return this.log("Wrong js params: Config "+JSON.stringify(b.displays_settings.vars)),!1}}return!0},b.checkURLVariables=function(a,b){if(!c)return!0;for(var d in b.displays_settings.params){var e=b.displays_settings.params[d];if(Object.prototype.hasOwnProperty.call(e,"right")){var f=!0;if(a.urlVariables.hasOwnProperty(e.param)&&a.urlVariables[e.param]==e.value?0==e.right&&(f=!1):1==e.right&&(f=!1),!f)return this.log("Wrong url params: Values: "+JSON.stringify(a.urlVariables)+" | Config "+JSON.stringify(b.displays_settings.params)),!1}}return!0},b.checkDevice=function(a,b){return 0===b.displays_settings.devices.length||b.displays_settings.devices.length>0&&-1!==b.displays_settings.devices.indexOf(this.getDeviceType(a.ua))?!0:(this.log("Wrong device: Values: "+this.getDeviceType(a.ua)+" | Config "+JSON.stringify(b.displays_settings.devices)),!1)},b.checkWorkingHours=function(a,b,d){if("landing"===b.kind)return!0;for(var e=c?-((new Date).getTimezoneOffset()/60):d.timezone,f=new Date((new Date).getTime()+60*e*60*1e3),g=f.getUTCDay()||7,h=null,i=0;i<b.work_time.length;i+=1)for(var j=0;j<b.work_time[i].days.length;j+=1)if(b.work_time[i].days[j]==g||Object.prototype.hasOwnProperty.call(b.work_time[i].days[j],"id")&&b.work_time[i].days[j].id==g){h=b.work_time[i];break}if(null!==h){var k=f.getUTCHours(),l=f.getUTCMinutes(),m=60*k+l,n=h.time_start.split(":"),o=60*parseInt(n[0])+parseInt(n[1]),p=h.time_end.split(":"),q=60*parseInt(p[0])+parseInt(p[1]);return m>=o&&q>=m?!0:(this.log("Wrong widget time: Values: "+f+" | Config "+JSON.stringify(b.work_time)),!1)}return this.log("Wrong widget time: Values: "+f+" | Config "+JSON.stringify(b.work_time)),!1},b.getOffice=function(a,b,c){var d=null,e=-1;for(var f in c.offices)if(Object.prototype.hasOwnProperty.call(c.offices,f)){var g=c.offices[f],h=g.coords.split(";"),i=this.getDistanceFromLatLonInKm(h[0],h[1],a,b);i<=c.distance_limit&&(-1===e||e>i)&&(d=g,e=i)}return d},b.checkRules=function(a,b,c,d){var e=this.getCheckingValues(c);if(a.enabled&&a.active&&a.is_licensed&&this.checkDomain(e,a)&&this.checkURL(e,a)&&this.checkJSVariables(e,a)&&this.checkURLVariables(e,a)&&this.checkDevice(e,a)&&this.checkWorkingHours(e,a,c)){if(!d)return!0;this.checkGEO(a,b,c)}else{if(!d)return!1;b(!1)}},b.checkGEO=function(a,b,d){if(c){var e=new XMLHttpRequest;e.open("POST","https://"+r.domain+".calltovisit.com/api"),e.setRequestHeader("Content-Type","application/json; charset=utf-8"),e.onreadystatechange=function(c){if(4===c.target.readyState&&200===c.target.status){var d=e.getResponseHeader("x-geo-country-db-id"),f=e.getResponseHeader("x-geo-city-db-id");o=f;var g=e.getResponseHeader("X-GEO-REGION-DB-ID")||-1,h=0===a.displays_settings.geo.countries.length||a.displays_settings.geo.countries.length>0&&d&&-1!==a.displays_settings.geo.countries.indexOf(d.toString()),i=0===a.displays_settings.geo.cities.length||a.displays_settings.geo.cities.length>0&&f&&(-1!==a.displays_settings.geo.cities.indexOf(f.toString())||-1!==a.displays_settings.geo.cities.indexOf(g.toString()));b(h&&i)}},e.onerror=function(a){b(!1)},e.send(JSON.stringify({action:"get_geo"}))}else{var f=d.country,g=d.city,h=0===a.displays_settings.geo.countries.length||a.displays_settings.geo.countries.length>0&&f&&-1!==a.displays_settings.geo.countries.indexOf(f.toString()),i=0===a.displays_settings.geo.cities.length||a.displays_settings.geo.cities.length>0&&g&&-1!==a.displays_settings.geo.cities.indexOf(g.toString());b(h&&i)}},b.log=function(a,b){c&&e(a,b)},b.getDistanceFromLatLonInKm=function(a,b,c,d){var e=6371,f=this.deg2rad(c-a),g=this.deg2rad(d-b),h=Math.sin(f/2)*Math.sin(f/2)+Math.cos(this.deg2rad(a))*Math.cos(this.deg2rad(c))*Math.sin(g/2)*Math.sin(g/2),i=2*Math.atan2(Math.sqrt(h),Math.sqrt(1-h));return e*i},b.deg2rad=function(a){return a*(Math.PI/180)},b.getDeviceType=function(a){var b,c,d,e;return b={},d=a.toLowerCase(),b.ios=function(){return b.iphone()||b.ipod()||b.ipad()},b.iphone=function(){return!b.windows()&&c("iphone")},b.ipod=function(){return c("ipod")},b.ipad=function(){return c("ipad")},b.android=function(){return!b.windows()&&c("android")},b.androidPhone=function(){return b.android()&&c("mobile")},b.androidTablet=function(){return b.android()&&!c("mobile")},b.blackberry=function(){return c("blackberry")||c("bb10")||c("rim")},b.blackberryPhone=function(){return b.blackberry()&&!c("tablet")},b.blackberryTablet=function(){return b.blackberry()&&c("tablet")},b.windows=function(){return c("windows")},b.windowsPhone=function(){return b.windows()&&c("phone")},b.windowsTablet=function(){return b.windows()&&c("touch")&&!b.windowsPhone()},b.fxos=function(){return(c("(mobile;")||c("(tablet;"))&&c("; rv:")},b.fxosPhone=function(){return b.fxos()&&c("mobile")},b.fxosTablet=function(){return b.fxos()&&c("tablet")},b.meego=function(){return c("meego")},b.mobile=function(){return b.androidPhone()||b.iphone()||b.ipod()||b.windowsPhone()||b.blackberryPhone()||b.fxosPhone()||b.meego()},b.tablet=function(){return b.ipad()||b.androidTablet()||b.blackberryTablet()||b.windowsTablet()||b.fxosTablet()},b.desktop=function(){return!b.tablet()&&!b.mobile()},b.television=function(){var a,b=["googletv","viera","smarttv","internet.tv","netcast","nettv","appletv","boxee","kylo","roku","dlnadoc","roku","pov_tv","hbbtv","ce-html"];for(a=0;a<b.length;){if(c(b[a]))return!0;a++}return!1},c=function(a){return-1!==d.indexOf(a)},b.ios()?b.ipad()?e="tablet":b.iphone()?e="mobile":b.ipod()&&(e="mobile"):e=b.android()?b.androidTablet()?"tablet":"mobile":b.blackberry()?b.blackberryTablet()?"tablet":"mobile":b.windows()?b.windowsTablet()?"tablet":b.windowsPhone()?"mobile":"desktop":b.fxos()?b.fxosTablet()?"tablet":"mobile":b.meego()?"mobile":b.television()?"television":(b.desktop(),"desktop"),e}}("undefined"==typeof exports?this.CTVTargeting={}:exports,"undefined"==typeof exports);var l,m,n,o,p=function(){function a(a){throw new RangeError(q[a])}function b(a,b){for(var c=[],d=a.length;d--;)c[d]=b(a[d]);return c}function c(a,c){var d=a.split("@"),e="";d.length>1&&(e=d[0]+"@",a=d[1]),a=a.replace(p,".");var f=a.split("."),g=b(f,c).join(".");return e+g}function d(a){for(var b=[],c=0,d=a.length;d>c;){var e=a.charCodeAt(c++);if(e>=55296&&56319>=e&&d>c){var f=a.charCodeAt(c++);56320==(64512&f)?b.push(((1023&e)<<10)+(1023&f)+65536):(b.push(e),c--)}else b.push(e)}return b}var e=2147483647,f=36,g=1,h=26,i=38,j=700,k=72,l=128,m="-",n=/^xn--/,o=/[^\0-\x7E]/,p=/[\x2E\u3002\uFF0E\uFF61]/g,q={overflow:"Overflow: input needs wider integers to process","not-basic":"Illegal input >= 0x80 (not a basic code point)","invalid-input":"Invalid input"},r=f-g,s=Math.floor,t=String.fromCharCode,u=function(a){return String.fromCodePoint.apply(null,a)},v=function(a){return 10>a-48?a-22:26>a-65?a-65:26>a-97?a-97:f},w=function(a,b){return a+22+75*(26>a)-((0!=b)<<5)},x=function(a,b,c){var d=0;for(a=c?s(a/j):a>>1,a+=s(a/b);a>r*h>>1;d+=f)a=s(a/r);return s(d+(r+1)*a/(a+i))},y=function(b){var c=[],d=b.length,i=0,j=l,n=k,o=b.lastIndexOf(m);0>o&&(o=0);for(var p=0;o>p;++p)b.charCodeAt(p)>=128&&a("not-basic"),c.push(b.charCodeAt(p));for(var q=o>0?o+1:0;d>q;){for(var r=i,t=1,u=f;;u+=f){q>=d&&a("invalid-input");var w=v(b.charCodeAt(q++));(w>=f||w>s((e-i)/t))&&a("overflow"),i+=w*t;var y=n>=u?g:u>=n+h?h:u-n;if(y>w)break;var z=f-y;t>s(e/z)&&a("overflow"),t*=z}var A=c.length+1;n=x(i-r,A,0==r),s(i/A)>e-j&&a("overflow"),j+=s(i/A),i%=A,c.splice(i++,0,j)}return String.fromCodePoint.apply(null,c)},z=function(b){var c=[];b=d(b);var i=b.length,j=l,n=0,o=k;b.forEach(function(a){128>a&&c.push(t(a))});var p=c.length,q=p;for(p&&c.push(m);i>q;){var r=e;b.forEach(function(a){a>=j&&r>a&&(r=a)});var u=q+1;r-j>s((e-n)/u)&&a("overflow"),n+=(r-j)*u,j=r,b.forEach(function(b){if(j>b&&++n>e&&a("overflow"),b==j){for(var d=n,i=f;;i+=f){var k=o>=i?g:i>=o+h?h:i-o;if(k>d)break;var l=d-k,m=f-k;c.push(t(w(k+l%m,0))),d=s(l/m)}c.push(t(w(d,0))),o=x(n,u,q==p),n=0,++q}}),++n,++j}return c.join("")},A=function(a){return c(a,function(a){return n.test(a)?y(a.slice(4).toLowerCase()):a})},B=function(a){return c(a,function(a){return o.test(a)?"xn--"+z(a):a})};return{ucs2:{decode:d,encode:u},decode:y,encode:z,toASCII:B,toUnicode:A}}(),q={Error:0,Warning:1,Info:2},r={domain:"widget"};if("object"==typeof a.ctvsData)for(var s=0;s<a.ctvsData.length;s+=1)r[a.ctvsData[s][0]]=a.ctvsData[s][1];for(var t="//"+r.domain+".calltovisit.com/widget.js",u=b.getElementsByTagName("script"),v=u.length-1;v>=0;--v){n=u[v].src.split("?"),m=n[0];var w=t.length;if(m&&m.substr(m.length-w)===t){l=u[v];break}}if("object"!=typeof a.ctvsData&&l){var x=n[1].split("&");for(var y in x)if(x.hasOwnProperty(y)){var z=x[y].split("=");r[z[0]]=z[1]}}f.prototype.init=function(a){if(null!==a&&(a.hasOwnProperty("config")||a.hasOwnProperty("configs"))){if(this.scriptTag=l,a.configs){var b=a.configs.split(",");if(!(b.length>A))return;this.config=b[A]}else{if(0!==A)return;this.config=a.config}this.getConfiguration(this.checkConfiguration.bind(this))}else e("Cannot get widget config. Please check your code.",q.Warning)},f.prototype.getConfiguration=function(a){var b=new XMLHttpRequest;b.open("GET","https://"+r.domain+".calltovisit.com/configs/"+this.config+"?"+1e4*Math.random()),b.onreadystatechange=function(b){4===b.target.readyState&&200===b.target.status&&a(null,b.target.response)},b.onerror=function(b){var c=new XMLHttpRequest;c.open("POST","https://"+r.domain+".calltovisit.com/api"),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.onreadystatechange=function(b){4===b.target.readyState&&200===b.target.status&&("fail"!==b.target.response?a(null,b.target.response):a(b.target.response))},c.onerror=function(b){a(b)},c.send(JSON.stringify({action:"get_backup_configuration",config:this.config}))}.bind(this),b.send()},f.prototype.checkConfiguration=function(b,d){if(null!==b)return void e("Cannot get widget config. Please check your code Error: "+JSON.stringify(b),q.Warning);var f,g;try{for(f=JSON.parse(d),g=0;g<f.length;g+=1)f[g]=JSON.parse(c(f[g]))}catch(i){e("Cannot get widget config. Please check your code",q.Warning)}sessionStorage.setItem("c2v.widgets",JSON.stringify(f));var j=[];for(g=0;g<f.length;g+=1)a.CTVTargeting.checkRules(f[g],null,null,!1)&&j.push(f[g]);j.length>0?this.checkGEORules(j,0):h()},f.prototype.checkConfigs=function(){var b=JSON.parse(sessionStorage.getItem("c2v.widgets")),c=[];for(v=0;v<b.length;v+=1)a.CTVTargeting.checkRules(b[v],null,null,!1)&&c.push(b[v]);c.length>0?this.checkGEORules(c,0):h()},f.prototype.checkGEORules=function(b,c){a.CTVTargeting.checkGEO(b[c],function(a){a?(this.widgetConfiguration=b[c],this.startShowing(a)):c+1<b.length?this.checkGEORules(b,c+1):h()}.bind(this),null,!0)},f.prototype.startShowing=function(b,c){if(b){switch(this.cid=this.widgetConfiguration.client_id,this.wid=this.widgetConfiguration.widget_id,this.pid=this.widgetConfiguration.project_id,this.widgetConfiguration.device=this.device=a.CTVTargeting.getDeviceType(a.navigator.userAgent),this.widgetConfiguration.type){case 1:this.widgetConfiguration.widget_type="standard";break;case 2:this.widgetConfiguration.widget_type="standart";break;case 3:this.widgetConfiguration.widget_type="fs";break;case 4:this.widgetConfiguration.widget_type="fs-back";break;case 5:this.widgetConfiguration.widget_type="domofond";break;case 6:this.widgetConfiguration.widget_type="avaho";break;case 7:this.widgetConfiguration.widget_type="landing";break;case 8:this.widgetConfiguration.widget_type="ordynka";break;case 9:this.widgetConfiguration.widget_type="dom-renome";break;case 10:this.widgetConfiguration.widget_type="pmo";break;case 11:this.widgetConfiguration.widget_type="jazz";break;case 12:this.widgetConfiguration.widget_type="hameleon";break;case 13:this.widgetConfiguration.widget_type="fs-back-romb";break;case 14:this.widgetConfiguration.widget_type="buttonless";break;case 15:this.widgetConfiguration.widget_type="sovkombank";break;case 16:this.widgetConfiguration.widget_type="pik"}this.widgetConfiguration.url=location.href;var d={today:{start:0,finish:24},tomorrow:{start:0,finish:1440}},e=(new Date).getDay()||7,f=e+1>7?1:e+1,g={today:e,tomorrow:f};for(var h in this.widgetConfiguration.offices)if(this.widgetConfiguration.offices.hasOwnProperty(h))for(var i in g)if(g.hasOwnProperty(i))for(var j=0;j<this.widgetConfiguration.offices[h].work_time.length;j+=1)if(-1!==this.widgetConfiguration.offices[h].work_time[j].days.indexOf(g[i])){var k=this.widgetConfiguration.offices[h].work_time[j],l=k.time_start.split(":"),m=60*parseInt(l[0])+parseInt(l[1]),n=k.time_end.split(":"),o=60*parseInt(n[0])+parseInt(n[1]);(-1===d[i].start||-1!==d[i].start&&m<d[i].start)&&(d[i].start=-1==m?0:m),(-1===d[i].finish||-1!==d[i].finish&&o>d[i].finish)&&(d[i].finish=-1==o?1440:o)}if(this.widgetConfiguration.schedule=d,"landing"===this.widgetConfiguration.kind)return void this.draw();var p=!1;try{var q="true"==a.sessionStorage.getItem("c2v.ordered");q&&(p=!0)}catch(r){}if(!p)if("individual_custom"===this.widgetConfiguration.kind)this.draw();else{var s=0;if(this.widgetConfiguration.autoshow>0)try{var t=1e3*this.widgetConfiguration.additional_settings.auto_show_time,u=a.sessionStorage.getItem("c2v.start");u?s=Date.now()-parseInt(u)>t?0:Math.abs(Date.now()-parseInt(u)-t):(a.sessionStorage.setItem("c2v.start",Date.now()),s=t)}catch(r){}else s=-1;if(s>0)setTimeout(function(){this.draw()}.bind(this),s);else if(0===s)this.draw();else if(c&&-1===s){var v=document.getElementById("c2v-root");v||this.draw()}}}},f.prototype.draw=function(){var c=b.createElement("link");c.rel="stylesheet",c.href="https://"+r.domain+".calltovisit.com/"+this.widgetConfiguration.widget_type+"/style.css",c.id="c2v-style",b.head.appendChild(c);var d=b.createElement("div");d.id="c2v-root","individual_custom"===this.widgetConfiguration.kind?this.root=this.scriptTag.parentNode.insertBefore(d,this.scriptTag):this.root=b.body.appendChild(d);var e=b.createElement("iframe");e.frameBorder=0,e.id="c2v-iframe",e.allow="geolocation *;",e.classList.add("position"+this.widgetConfiguration.position),"custom"===this.widgetConfiguration.kind&&((this.widgetConfiguration.position<5||8==this.widgetConfiguration.position)&&(e.style.paddingBottom=this.widgetConfiguration.additional_settings.offset.y+"px"),this.widgetConfiguration.position>=5&&this.widgetConfiguration.position<8&&(e.style.paddingTop=this.widgetConfiguration.additional_settings.offset.y+"px"),this.widgetConfiguration.position>1&&this.widgetConfiguration.position<7&&(e.style.paddingLeft=this.widgetConfiguration.additional_settings.offset.x+"px"),(1==this.widgetConfiguration.position||this.widgetConfiguration.position>=7)&&(e.style.paddingRight=this.widgetConfiguration.additional_settings.offset.x+"px")),e.src=["https://",r.domain,".calltovisit.com/",this.widgetConfiguration.widget_type,"/iframe_"+this.widgetConfiguration.lang,".html"].join(""),this.frame=this.root.appendChild(e),a.c2vMessageFunc=this.onMessage.bind(this),a.addEventListener("message",a.c2vMessageFunc),this.fetchLocationCoordinates();var f;f=Object.prototype.hasOwnProperty.call(a,"onorientationchange")?"orientationchange":"resize",a.c2vOrientFunc=this.onOrientationChange.bind(this),a.addEventListener?a.addEventListener(f,a.c2vOrientFunc,!1):a.attachEvent?a.attachEvent(f,a.c2vOrientFunc):a[f]=a.c2vOrientFunc},f.prototype.fetchLocationCoordinates=function(){if(!o)return void this.frame.addEventListener("load",function(){this.sendMessageToFrame("geoid-fail")}.bind(this));var a=new XMLHttpRequest;a.open("POST","https://"+r.domain+".calltovisit.com/api"),a.setRequestHeader("Content-Type","application/json; charset=utf-8"),a.onreadystatechange=function(a){if(4===a.target.readyState){var b=a.target.response;this.frame.addEventListener("load",function(){try{var a=JSON.parse(b);return void(a.id&&this.sendMessageToFrame("geoid-success",a))}catch(c){console.error(c)}this.sendMessageToFrame("geoid-fail")}.bind(this))}}.bind(this),a.onerror=function(){this.frame.addEventListener("load",function(){this.sendMessageToFrame("geoid-fail")})}.bind(this),a.send(JSON.stringify({action:"get_city_by_geoid",geoid:o}))},f.prototype.destroyWidget=function(){var a=document.getElementById("c2v-root");a.parentNode.removeChild(a)},f.prototype.officeIsOpened=function(a,b){function c(a){var b=a.split(":").map(function(a){return parseInt(a,10)});return 60*b[0]+b[1]}var d=new Date;if(b&&b.day&&b.time){var e="tomorrow"===b.day?1:0;e&&(d=new Date(d.setUTCDate(d.getUTCDate()+e)));var f=b.time.split(":");d=d.setUTCHours(f[0],f[1])}else d=d.getTime()+36e5*a.timezone;d=new Date(d);var g=60*d.getUTCHours()+d.getUTCMinutes(),h=d.getUTCDay();return h=0===h?7:h,a.work_time.filter(function(a){var b=c(a.time_start||"00:00"),d=c(a.time_end||"23:59");return a.days.indexOf(h)>-1&&g>=b&&d>=g}).length>0},f.prototype.sendOrder=function(b){var c=[],d="",e="",f=window.location.search.substr(1).split("&");if(""!=f[0])for(v=0;v<f.length;v++)c=f[v].split("="),"utm_source"==c[0]?d=c[1]:"utm_campaign"==c[0]&&(e=c[1]);b.utm_source=d,b.utm_campaign=e;var g,h=!1,i=!1;if(b.inverted&&(g=this.widgetConfiguration.offices[b.selectedOffice],h=void 0!==g,i=!0),h||(g=a.CTVTargeting.getOffice(b.address.point[1],b.address.point[0],this.widgetConfiguration),h=null!==g,h&&(i=this.officeIsOpened(g,b))),h&&i){var j=new XMLHttpRequest;j.open("POST","https://"+r.domain+".calltovisit.com/api"),j.setRequestHeader("Content-Type","application/json; charset=utf-8"),j.onreadystatechange=function(c){if(4==c.target.readyState)if(200==c.target.status){this.sendMessageToFrame("order-send-result",c.target.response);var d=JSON.parse(c.target.response);d.success&&("function"==typeof a.onC2VEvent&&a.onC2VEvent("orderSuccess",d.order_id),this.widgetConfiguration.comagic&&a.hasOwnProperty("comagicSend")&&a.comagicSend(b.phone.value,"CallToVisit: "+b.address.source.formatted)),"custom"===this.widgetConfiguration.kind&&a.sessionStorage.setItem("c2v.ordered",!0)}else this.sendMessageToFrame("order-warn")}.bind(this),j.onerror=function(){this.sendMessageToFrame("order-error")}.bind(this),j.send(JSON.stringify(b))}else if(h)this.sendMessageToFrame("order-error",{time:"office_closed",type:g.type,deffered:!!b.day});else if(this.sendMessageToFrame("order-error","too_far"),"true"!=a.sessionStorage.getItem("c2v.far")&&b.data.phone.value){var j=new XMLHttpRequest;j.open("POST","https://"+r.domain+".calltovisit.com/api"),j.setRequestHeader("Content-Type","application/json; charset=utf-8"),j.onreadystatechange=function(b){4==b.target.readyState&&200==b.target.status&&a.sessionStorage.setItem("c2v.far",!0)}.bind(this),j.send(JSON.stringify({wid:b.wid,phone:b.phone,action:"send_too_far_notification"}))}},f.prototype.cancelOrder=function(b){var c=new XMLHttpRequest;c.open("POST","https://"+r.domain+".calltovisit.com/api"),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.onreadystatechange=function(b){4==b.target.readyState&&(200==b.target.status?(this.sendMessageToFrame("cancel-order-result",b.target.response),a.sessionStorage.setItem("c2v.canceled",!0)):this.sendMessageToFrame("cancel-order-error"))}.bind(this),c.onerror=function(){this.sendMessageToFrame("cancel-order-error")}.bind(this),c.send(JSON.stringify(b))},f.prototype.verifyOrder=function(b){var c=new XMLHttpRequest;c.open("POST","https://"+r.domain+".calltovisit.com/api"),c.setRequestHeader("Content-Type","application/json; charset=utf-8"),c.onreadystatechange=function(c){4==c.target.readyState&&(200==c.target.status?(this.sendMessageToFrame("verify-result",c.target.response),JSON.parse(c.target.response).success&&this.widgetConfiguration.comagic&&a.hasOwnProperty("comagicSend")&&a.comagicSend(b.phone.value,"CallToVisit: "+b.address.source.formatted),a.sessionStorage.setItem("c2v.ordered",!0)):this.sendMessageToFrame("verify-error"))}.bind(this),c.onerror=function(){this.sendMessageToFrame("verify-error")}.bind(this),c.send(JSON.stringify(b))},f.prototype.refreshOrderSms=function(a){var b=new XMLHttpRequest;b.open("POST","https://"+r.domain+".calltovisit.com/api"),b.setRequestHeader("Content-Type","application/json; charset=utf-8"),b.onreadystatechange=function(a){4==a.target.readyState&&(200==a.target.status?this.sendMessageToFrame("order-refresh-sms-result",a.target.response):this.sendMessageToFrame("order-refresh-sms-error"))}.bind(this),b.onerror=function(){this.sendMessageToFrame("order-refresh-sms-error")}.bind(this),b.send(JSON.stringify(a))},f.prototype.onOrientationChange=function(){this.sendMessageToFrame("orientation",{orientation:d()})},f.prototype.onMessage=function(b){if(b.origin===this.frame.src.match(/^.+\:\/\/[^\‌​\/]+/)[0])try{var c,d=JSON.parse(b.data);switch(d.type){case"load":if(this.uid=d.data.uid,this.stat=new g(this.cid,this.wid,this.pid,this.uid,this.config,this.device),this.sendMessageToFrame("config",this.widgetConfiguration),this.widgetConfiguration.autohide>0){var e=500;try{var f=1e3*this.widgetConfiguration.additional_settings.auto_hide_time,h=a.sessionStorage.getItem("c2v.show");h?e=Date.now()-parseInt(h)>f?500:Math.abs(Date.now()-parseInt(h)-f):(a.sessionStorage.setItem("c2v.show",Date.now()),e=f)}catch(i){}var j=!1;try{var k="true"==a.sessionStorage.getItem("c2v.showed");k&&(j=!0)}catch(i){}j||setTimeout(function(){this.hasAction||(a.sessionStorage.setItem("c2v.showed",!0),this.sendMessageToFrame("show",{auto:!0}))}.bind(this),e)}break;case"hide":this.frame.classList.remove("opened"),c="clickClose";break;case"check-office":if(null!==a.CTVTargeting.getOffice(d.data.address.point[1],d.data.address.point[0],this.widgetConfiguration))this.sendMessageToFrame("check-office-result",{status:"ok"});else if(this.sendMessageToFrame("check-office-result",{status:"too_far",distance_limit:this.widgetConfiguration.distance_limit}),"true"!=a.sessionStorage.getItem("c2v.far")&&d.data.phone.value){var l=new XMLHttpRequest;l.open("POST","https://"+r.domain+".calltovisit.com/api"),l.setRequestHeader("Content-Type","application/json; charset=utf-8"),l.onreadystatechange=function(b){4==b.target.readyState&&200==b.target.status&&a.sessionStorage.setItem("c2v.far",!0)}.bind(this),l.send(JSON.stringify({wid:d.data.wid,phone:d.data.phone,action:"send_too_far_notification"}))}break;case"order-send":this.sendOrder(d.data),c="clickSend";break;case"order-cancel":this.cancelOrder(d.data),c="clickCancel";break;case"order-verify":this.verifyOrder(d.data),c="clickVerifySms";break;case"order-refresh-sms":this.refreshOrderSms(d.data),c="clickRefreshSms";break;case"next-step":c="nextStep";break;case"show":this.frame.classList.add("opened"),this.hasAction=!0,a.sessionStorage.setItem("c2v.showed",!0),c=d.data&&d.data.action?"clickOpen":null;break;case"stat":this.stat.trackEvent(d.data.event);break;case"addIframeClass":this.frame.classList.add(d.data["class"]);break;case"removeIframeClass":this.frame.classList.remove(d.data["class"])}if(c&&("function"==typeof a.onC2VEvent&&a.onC2VEvent(c),"clickOpen"===c||"clickClose"===c||"clickSend"===c)){if("function"==typeof a.ga&&(a.ga("send",c),a.ga.hasOwnProperty("getAll")&&"function"==typeof a.ga.getAll)){var m=a.ga.getAll();if("object"==typeof m&&m.length)for(var n in m)"function"==typeof m[n].send&&m[n].send("event","C2V",c)}var o=Object.getOwnPropertyNames(a).filter(function(b){return 0===b.indexOf("yaCounter")&&"object"==typeof a[b]});if(o.length)for(var p in o)a.hasOwnProperty(o[p])&&"object"==typeof a[o[p]]&&a[o[p]].hasOwnProperty("reachGoal")&&"function"==typeof a[o[p]].reachGoal&&a[o[p]].reachGoal(c)}}catch(q){}},f.prototype.sendMessageToFrame=function(a,b){this.frame.contentWindow.postMessage(JSON.stringify({type:a,data:b,provider:"call2visit"}),"*")},g.prototype.trackEvent=function(a){var c=new Image;c.src="https://stats.calltovisit.com/stat/?cid="+this.cid+"&wid="+this.wid+"&pid="+this.pid+"&uid="+this.uid+"&event="+a+"&device="+this.device+"&ref="+encodeURIComponent(b.referrer)};var A=-1;a.CTVWidget=new f;var B=window.location.pathname;!function(){setInterval(k,100)}(),h()}(window,document);